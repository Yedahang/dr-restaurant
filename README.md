# dr-restaurant
2022年华南理工大学"灵犀互娱杯“程序设计大赛二等奖参赛作品

致敬了本人小时候非常喜欢的一款像素风游戏——吃货大食堂

### 设计介绍

----

模拟经营类游戏

在不能引入任何高度封装的**第三方外部库**的比赛要求下，通过**纯C++代码**的命令行实现具有高清流畅的**字符**画面显示的Windows控制台命令窗口游戏。

-  游戏框架：搭建了UI显示控制单元、资源管理单元、交互控制单元、游戏引擎等的基础框架,提高游戏开发效率和系统性能。

- 游戏画面：以字符画输出的形式实现流畅的画面显示。应用双缓冲技术解决画面频闪问题。实现了游戏画面的分层化渲染。

- 游戏引擎：实现了碰撞体积与碰撞检测的2.5D游戏处理引擎。基于Astar算法实现了游戏NPC自动寻路功能等。

#### **游戏玩法、内容结构图**

<img src="assets/image-20240308160427648.png" alt="image-20240308160427648" style="zoom:67%;" />



#### **游戏框架**

​	<img src="assets/image-20240308160503235.png" alt="image-20240308160503235" style="zoom:67%;" />	

#### UI展示

<img src="assets/image-20240308161520995.png" alt="image-20240308161520995" style="zoom:80%;" />

![image-20240308161451397](assets/image-20240308161451397.png)

![image-20240308161538964](assets/image-20240308161538964.png)



### 技术实现

---

ps:	内容较长，从报告文档中摘取出来

#### 1. 前期准备——模型资源

利用ASCII Generator软件将模型相应的图片转化成字符画，以文本的形式储存在txt文档中，在程序运行的时候进行加载。

<img src="assets/image-20240308163236118.png" alt="image-20240308163236118" style="zoom:67%;" />

<div><table frame=void>	<!--用了<div>进行封装-->
	<tr>
        <td><div><center>	<!--每个格子内是图片加标题-->
        	<img src="assets/image-20240308163652940.png"
                 alt="Typora-Logo"
                 height="200"/>	<!--高度设置-->
        	<br>	<!--换行-->
        	将图片转化成字符画	<!--标题1-->
        </center></div></td>    
     	<td><div><center>	<!--第二张图片-->
    		<img src="assets/image-20240308164304803.png"
                 alt="Typora-Logo"
                 height="200"/>	
    		<br>
    		字符画以text的格式存储起来
        </center></div></td>
	</tr>
</table></div>





#### 2. UI框架

由于赛题要求不能引入任何高度封装的**第三方外部库**, 甚至一些简单的图像处理的库都不允许，如何实现游戏画面的显示就成为了一大难题。于是，本项目决定手撸复现一个UI内核框架。

##### 2.1 画面

**字符模拟像素。**将控制台的字符大小设置为最小，以屏幕左上角为原点建立如图坐标系，每一个坐标点的字符对应于画面中的一个”像素“。

![image-20240308165248931](assets/image-20240308165248931.png)

##### 2.2 双缓冲技术（？华工软院祖传技术）

游戏动画实现原理：利用人视觉暂留效应，通过控制台不断刷新并输出不同的字符画面，实现游戏动画的流畅显示。

但是，在实现过程中发现，由于控制台字符输出速度有限，字符输出速度比画面刷新速度慢，导致游戏画面出现闪屏的问题，于是采用双缓冲技术解决此问题。双缓冲技术是一种使用两个缓冲区的图形渲染技术，通过在后缓冲区进行绘制，并在绘制完成后将其内容复制到前缓冲区，实现平滑的图形更新，避免画面闪烁和绘图不连贯的问题。

<div><table frame=void>	<!--用了<div>进行封装-->
	<tr>
        <td><div><center>	<!--每个格子内是图片加标题-->
        	<img src="assets/1.gif"
                 alt="Typora-Logo"
                 height="200"/>	<!--高度设置-->
        	<br>	<!--换行-->
        	频闪问题	<!--标题1-->
        </center></div></td>    
     	<td><div><center>	<!--第二张图片-->
    		<img src="assets/image-20240308171552887.png"
                 alt="Typora-Logo"
                 height="200"/>	
    		<br>
    		双缓冲技术
        </center></div></td>
	</tr>
</table></div>

##### 2.3 画面的分层化渲染（图层渲染内核）

**按照层次结构绘制和呈现游戏对象。**每个游戏对象都被分配到特定的图层，然后按照指定的顺序逐个渲染这些图层，以创建正确的遮挡和叠加效果。当然，这个方法缺点也很明显，会导致"over-rendering"（过度渲染），此方法会增加内存占用，增加复杂性和额外的管理开销、性能开销、渲染顺序限制。但是，由于当时本人才大一并且比赛时间有限，并没有进一步解决这个问题。概括地说，就是一层一层地贴图。

<img src="assets/image-20240308173928347.png" alt="image-20240308173928347" style="zoom:80%;" />

##### 2.4 人物移动动画

在每个游戏帧中，根据当前位置和动画帧序列的当前帧，绘制正确的帧图像来显示人物的移动动画。

<div><table frame=void>	<!--用了<div>进行封装-->
	<tr>
        <td><div><center>	<!--每个格子内是图片加标题-->
        	<img src="assets/image-20240308174132874.png"
                 alt="Typora-Logo"
                 height="200"/>	<!--高度设置-->
        	<br>	<!--换行-->
        	动画帧序列	<!--标题1-->
        </center></div></td>    
     	<td><div><center>	<!--第二张图片-->
    		<img src="assets/2.gif"
                 alt="Typora-Logo"
                 height="200"/>	
    		<br>
    		控制帧的播放
        </center></div></td>
	</tr>
</table></div>

#### 3.计算层内核

##### 3.1 基于A星算法的人物自动寻路

**碰撞体积。**用一个二维数组表示人物可移动地图，0表示可通，1表示障碍物(碰撞体积）。

<img src="assets/image-20240308175040801.png" alt="image-20240308175040801" style="zoom:50%;" />示例：绿色为起点，红色为终点，蓝色为障碍物





